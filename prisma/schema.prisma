generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SensorReading {
  id          Int      @id @default(autoincrement())
  temperature Float
  humidity    Float
  timestamp   DateTime @default(now())
  location    String?  @default("Default Room")
  deviceId    String?  @default("SHT20-001")
  receivedAt  DateTime @default(now())

  @@map("sensor_readings")
}

model DailyAverage {
  id           Int      @id @default(autoincrement())
  date         DateTime @unique @db.Date
  avgTemp      Float    @map("avg_temperature")
  avgHumidity  Float    @map("avg_humidity")
  maxTemp      Float    @map("max_temperature")
  minTemp      Float    @map("min_temperature")
  maxHumidity  Float    @map("max_humidity")
  minHumidity  Float    @map("min_humidity")
  readingCount Int      @map("reading_count")

  @@map("daily_averages")
}

model MqttMessageLog {
  id          Int      @id @default(autoincrement())
  topic       String
  message     String   // JSON string of the MQTT message
  qos         Int      @default(0)
  retain      Boolean  @default(false)
  timestamp   DateTime @default(now())
  receivedAt  DateTime @default(now())
  processed   Boolean  @default(false) // Flag untuk tracking message yang sudah diproses
  deviceId    String?
  messageType String?  // 'sensor_data', 'command', 'status', etc.

  @@map("mqtt_message_logs")
  @@index([topic, timestamp])
  @@index([retain, processed])
  @@index([deviceId, timestamp])
}

model RetainMessage {
  id        Int      @id @default(autoincrement())
  topic     String   @unique
  message   String   // JSON string of the retained message
  qos       Int      @default(0)
  timestamp DateTime @default(now())
  updatedAt DateTime @updatedAt
  deviceId  String?

  @@map("retain_messages")
  @@index([topic])
  @@index([deviceId])
}
